# Copyright (c) Meta Platforms, Inc. and affiliates.
# All rights reserved.
#
# This source code is licensed under the BSD-style license found in the
# LICENSE file in the root directory of this source tree.

reduce_buffer:
  parameter_names_with_default_values:
    DTYPE: float
    STORAGE: buffer
    INIT_ACCUM: T(0)
    UPDATE_ACCUM: accum + new_val
    POSTPROCESS: accum
    VARIANCE_MODE: false
  generate_variant_forall:
    DTYPE:
      - VALUE: half
      - VALUE: float
  shader_variants:
    - NAME: sum_buffer
    - NAME: mean_buffer
      POSTPROCESS: (accum / T(in_sizes[reduce_dim]))
    - NAME: amax_buffer
      INIT_ACCUM: first_val
      UPDATE_ACCUM: max(accum, new_val)
      POSTPROCESS: accum
    - NAME: amin_buffer
      INIT_ACCUM: first_val
      UPDATE_ACCUM: min(accum, new_val)
      POSTPROCESS: accum
    - NAME: var_buffer
      VARIANCE_MODE: true
