# Copyright 2025 Arm Limited and/or its affiliates.
#
# This source code is licensed under the BSD-style license found in the
# LICENSE file in the root directory of this source tree.

# @noautodeps
load("@fbcode_macros//build_defs:python_library.bzl", "python_library")

python_library(
    name = "constants",
    srcs = [
        "constants.py",
    ],
    deps = [
        "//executorch/exir/dialects:lib",
    ],
)
python_library(
    name = "common",
    srcs = [
        "common/__init__.py",
        "common/debug.py",
    ],
    deps = [
        "fbsource//third-party/tosa_tools/v0.80/serialization_lib/python/serializer:serializer",
        "fbsource//third-party/tosa_tools/v1.00/serialization_lib/python/serializer:serializer",
        "//caffe2:torch",
        "//executorch/exir:lib",
    ],
)

python_library(
    name = "arm_compile_spec",
    srcs = [
        "common/arm_compile_spec.py",
    ],
    deps = [
        "fbsource//third-party/pypi/flatbuffers:flatbuffers",
        "fbsource//third-party/pypi/ml-dtypes:ml-dtypes",
        "fbsource//third-party/tosa_tools/v0.80/serialization_lib/python/serializer:serializer",
        "fbsource//third-party/tosa_tools/v1.00/serialization_lib/python/serializer:serializer",
        "fbsource//third-party/tosa_tools/v0.80/serialization_lib/python/tosa:tosa",
        "fbsource//third-party/tosa_tools/v1.00/serialization_lib/python/tosa:tosa",
        ":arm_vela",
        ":process_node",
        "//executorch/exir/backend:compile_spec_schema",
        "//executorch/backends/arm/operators:lib",
        "//executorch/backends/arm/operators:node_visitor",
        "//executorch/backends/arm/_passes:passes",
    ],
)

python_library(
    name = "ethosu",
    srcs = [
        "ethosu/__init__.py",
        "ethosu/backend.py",
        "ethosu/compile_spec.py",
        "ethosu/partitioner.py",
    ],
    deps = [
        ":arm_compile_spec",
        ":arm_vela",
        "//executorch/backends/arm/tosa:specification",
        "//executorch/backends/arm/tosa:partitioner",
    ],
)

python_library(
    name = "tosa_compile_spec",
    srcs = [
        "tosa/__init__.py",
        "tosa/compile_spec.py",
    ],
    deps = [
        ":arm_compile_spec",
        "//executorch/backends/arm/tosa:specification",
    ],
)

python_library(
    name = "vgf",
    srcs = [
        "vgf/__init__.py",
        "vgf/backend.py",
        "vgf/compile_spec.py",
        "vgf/partitioner.py",
    ],
    deps = [
        ":arm_compile_spec",
        "//executorch/backends/arm/tosa:specification",
        "//executorch/backends/arm/tosa:partitioner",
    ],
)

python_library(
    name = "process_node",
    srcs = ["process_node.py"],
    deps = [
        "fbsource//third-party/tosa_tools/v0.80/serialization_lib/python/tosa:tosa",
        "fbsource//third-party/tosa_tools/v1.00/serialization_lib/python/tosa:tosa",
        "//executorch/backends/arm/operators:node_visitor",
        "//executorch/backends/arm/tosa:mapping",
        "//executorch/backends/arm/tosa:quant_utils",
        "//executorch/backends/arm/tosa:utils",
        "//executorch/exir:lib",
    ],
)
python_library(
    name = "arm_vela",
    srcs = [
        "arm_vela.py",
    ],
    deps = [
        "fbsource//third-party/pypi/ethos-u-vela:ethos-u-vela",
    ],
)
python_library(
    name = "arm_model_evaluator",
    srcs = [
        "util/arm_model_evaluator.py",
    ],
    deps = [
        "//caffe2:torch",
    ]
)
