


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bundled Program – a Tool for ExecuTorch Model Validation &mdash; ExecuTorch  documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/ExecuTorch-Logo-cropped.svg"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/progress-bar.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Prerequisite | ETRecord - ExecuTorch Record" href="sdk-etrecord.html" />
    <link rel="prev" title="Introduction to the ExecuTorch SDK" href="sdk-overview.html" />


  <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T8XT4PS');</script>
    <!-- End Google Tag Manager -->
  


  
  <script src="_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torcharrow">
                  <span class="dropdown-title">torcharrow</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/data">
                  <span class="dropdown-title">TorchData</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchrec">
                  <span class="dropdown-title">TorchRec</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/torchx/">
                  <span class="dropdown-title">TorchX</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorch’s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/foundation">
                  <span class="dropdown-title">PyTorch Foundation</span>
                  <p>Learn about the PyTorch foundation</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/community-stories">
                  <span class="dropdown-title">Community Stories</span>
                  <p>Learn how our community solves real, everyday machine learning problems with PyTorch.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/events">
                  <span class="dropdown-title">Events</span>
                  <p>Find events, webinars, and podcasts</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href='https://pytorch.org/executorch/versions.html'> &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro-overview.html">ExecuTorch Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">ExecuTorch Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro-how-it-works.html">How ExecuTorch Works</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting-started-architecture.html">High-level Architecture and Components of ExecuTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started-setup.html">Setting Up ExecuTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime-build-and-cross-compilation.html">Building with CMake</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/export-to-executorch-tutorial.html">Exporting to ExecuTorch Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="running-a-model-cpp-tutorial.html">Running an ExecuTorch Model in C++ Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/sdk-integration-tutorial.html">Using the ExecuTorch SDK to Profile a Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo-apps-ios.html">Building an ExecuTorch iOS Demo App</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo-apps-android.html">Building an ExecuTorch Android Demo App</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples-end-to-end-to-lower-model-to-delegate.html">Lowering a Model as a Delegate</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial-xnnpack-delegate-lowering.html">Building and Running ExecuTorch with XNNPACK Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="executorch-arm-delegate-tutorial.html">Building and Running ExecuTorch with ARM Ethos-U Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="build-run-coreml.html">Building and Running ExecuTorch with Core ML Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="build-run-mps.html">Building and Running ExecuTorch with MPS Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="build-run-qualcomm-ai-engine-direct-backend.html">Building and Running ExecuTorch with Qualcomm AI Engine Direct Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="build-run-xtensa.html">Building and Running ExecuTorch on Xtensa HiFi4 DSP</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exporting to ExecuTorch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="export-overview.html">Exporting to ExecuTorch</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="export-to-executorch-api-reference.html">Export to ExecuTorch API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="executorch-runtime-api-reference.html">ExecuTorch Runtime API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IR Specification</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ir-exir.html">Export IR Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="ir-ops-set-definition.html">Definition of the Core ATen Operator Set</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Compiler Entry Points</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="compiler-delegate-and-partitioner.html">Backend and Delegate</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler-backend-dialect.html">Backend Dialect</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler-custom-compiler-passes.html">Custom Compiler Passes and Partitioners</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler-memory-planning.html">Memory Planning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Runtime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="runtime-overview.html">ExecuTorch Runtime Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime-backend-delegate-implementation-and-linking.html">Backend Delegate Implementation and Linking</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime-platform-abstraction-layer.html">Runtime Platform Abstraction Layer (PAL)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quantization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quantization-overview.html">Quantization Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kernel Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="kernel-library-overview.html">Overview of ExecuTorch’s Kernel Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernel-library-custom-aten-kernel.html">Kernel Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernel-library-selective-build.html">Kernel Library Selective Build</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Native Delegates</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="native-delegates-executorch-xnnpack-delegate.html">ExecuTorch XNNPACK delegate</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SDK</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="sdk-overview.html">Introduction to the ExecuTorch SDK</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Bundled Program – a Tool for ExecuTorch Model Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk-etrecord.html">Prerequisite | ETRecord - ExecuTorch Record</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk-etdump.html">Prerequisite | ETDump - ExecuTorch Dump</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk-profiling.html">Profiling Models in ExecuTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk-inspector.html">Inspector APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk-delegate-integration.html">SDK Delegate Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk-tutorial.html">SDK usage tutorial</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>Bundled Program – a Tool for ExecuTorch Model Validation</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="_sources/sdk-bundled-io.md.txt" rel="nofollow"><img src="_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        


          <!-- Google Tag Manager (noscript) -->
          <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8XT4PS"
          height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
          <!-- End Google Tag Manager (noscript) -->
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="section" id="bundled-program-a-tool-for-executorch-model-validation">
<h1>Bundled Program – a Tool for ExecuTorch Model Validation<a class="headerlink" href="#bundled-program-a-tool-for-executorch-model-validation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>BundledProgram is a wrapper around the core ExecuTorch program designed to help users wrapping test cases with the model they deploy. BundledProgram is not necessarily a core part of the program and not needed for its execution, but is particularly important for various other use-cases, such as model correctness evaluation, including e2e testing during the model bring-up process.</p>
<p>Overall, the procedure can be broken into two stages, and in each stage we are supporting:</p>
<ul class="simple">
<li><p><strong>Emit stage</strong>: Bundling the test I/O cases along with the ExecuTorch program, serializing into flatbuffer.</p></li>
<li><p><strong>Runtime stage</strong>: Accessing, executing, and verifying the bundled test cases during runtime.</p></li>
</ul>
</div>
<div class="section" id="emit-stage">
<h2>Emit stage<a class="headerlink" href="#emit-stage" title="Permalink to this headline">¶</a></h2>
<p>This stage mainly focuses on the creation of a <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> and dumping it out to the disk as a flatbuffer file. The main procedure is as follow:</p>
<ol class="arabic simple">
<li><p>Create a model and emit its ExecuTorch program.</p></li>
<li><p>Construct a <code class="docutils literal notranslate"><span class="pre">BundledConfig</span></code> to record all info that needs to be bundled.</p></li>
<li><p>Generate <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> by using the emited model and <code class="docutils literal notranslate"><span class="pre">BundledConfig</span></code>.</p></li>
<li><p>Serialize the <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> and dump it out to the disk.</p></li>
</ol>
<div class="section" id="step-1-create-a-model-and-emit-its-executorch-program">
<h3>Step 1: Create a Model and Emit its ExecuTorch Program.<a class="headerlink" href="#step-1-create-a-model-and-emit-its-executorch-program" title="Permalink to this headline">¶</a></h3>
<p>ExecuTorch Program can be emitted from user’s model by using ExecuTorch APIs. Follow the <a class="reference internal" href="getting-started-setup.html"><span class="doc std std-doc">Generate Sample ExecuTorch program</span></a> or <a class="reference internal" href="tutorials/export-to-executorch-tutorial.html"><span class="doc std std-doc">Exporting to ExecuTorch tutorial</span></a>.</p>
</div>
<div class="section" id="step-2-construct-bundledconfig">
<h3>Step 2: Construct <code class="docutils literal notranslate"><span class="pre">BundledConfig</span></code><a class="headerlink" href="#step-2-construct-bundledconfig" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">BundledConfig</span></code> is a class under <code class="docutils literal notranslate"><span class="pre">executorch/bundled_program/config.py</span></code> that contains all information to be bundled for model verification. Here’s the constructor api to create <code class="docutils literal notranslate"><span class="pre">BundledConfig</span></code>:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<code class="docutils literal notranslate"><span class="pre">BundledConfig</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">bundled_program.config.BundledConfig.</span></span><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected_outputs</span></span></em><span class="sig-paren">)</span></dt>
<dd><p class="sd-card-text">Contruct the config given inputs and expected outputs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p class="sd-card-text"><strong>method_names</strong> – All method names need to be verified in program.</p></li>
<li><p class="sd-card-text"><strong>inputs</strong> – <p class="sd-card-text">All sets of input need to be test on for all methods. Each list
of <cite>inputs</cite> is all sets which will be run on the method in the
program with corresponding method name. Each set of any <cite>inputs</cite> element should
contain all inputs required by eager_model with the same inference function
as corresponding execution plan for one-time execution.</p>
<p class="sd-card-text">It is worth mentioning that, although both bundled program and ET runtime apis support setting input
other than torch.tensor type, only the input in torch.tensor type will be actually updated in
the method, and the rest of the inputs will just do a sanity check if they match the default value in method.</p>
</p></li>
<li><p class="sd-card-text"><strong>expected_outputs</strong> – Expected outputs for inputs sharing same index. The size of
expected_outputs should be the same as the size of inputs and provided method_names.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p class="sd-card-text">self</p>
</dd>
</dl>
</dd></dl>

</div>
</details></div>
<div class="section" id="step-3-generate-bundledprogram">
<h3>Step 3: Generate <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code><a class="headerlink" href="#step-3-generate-bundledprogram" title="Permalink to this headline">¶</a></h3>
<p>We provide <code class="docutils literal notranslate"><span class="pre">create_bundled_program</span></code> API under <code class="docutils literal notranslate"><span class="pre">executorch/bundled_program/core.py</span></code> to generate <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> by bundling the emitted ExecuTorch program with the bundled_config:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">bundled_program.core.</span></span><span class="sig-name descname"><span class="pre">create_bundled_program</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">program</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bundled_config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bundled_program/core.html#create_bundled_program"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p class="sd-card-text">Create BundledProgram by bundling the given program and bundled_config together.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p class="sd-card-text"><strong>program</strong> – The program to be bundled.</p></li>
<li><p class="sd-card-text"><strong>bundled_config</strong> – The config to be bundled.</p></li>
</ul>
</dd>
</dl>
<p class="sd-card-text">Returns: The <cite>BundledProgram</cite> variable contains given ExecuTorch program and test cases.</p>
</dd></dl>

</div>
</details><p><code class="docutils literal notranslate"><span class="pre">create_bundled_program</span></code> will do sannity check internally to see if the given BundledConfig matches the given Program’s requirements. Specifically:</p>
<ol class="arabic simple">
<li><p>The name of methods we create BundledConfig for should be also in program. Please notice that it is no need to set testcases for every method in the Program.</p></li>
<li><p>The metadata of each testcase should meet the requirement of the coresponding inference methods input.</p></li>
</ol>
</div>
<div class="section" id="step-4-serialize-bundledprogram-to-flatbuffer">
<h3>Step 4: Serialize <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> to Flatbuffer.<a class="headerlink" href="#step-4-serialize-bundledprogram-to-flatbuffer" title="Permalink to this headline">¶</a></h3>
<p>To serialize <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> to make runtime APIs use it, we provide two APIs, both under <code class="docutils literal notranslate"><span class="pre">executorch/bundled_program/serialize/__init__.py</span></code>.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Serialize and Deserialize<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">bundled_program.serialize.</span></span><span class="sig-name descname"><span class="pre">serialize_from_bundled_program_to_flatbuffer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bundled_program</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bundled_program/serialize.html#serialize_from_bundled_program_to_flatbuffer"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p class="sd-card-text">Serialize a BundledProgram into FlatBuffer binary format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p class="sd-card-text"><strong>bundled_program</strong> (<em>BundledProgram</em>) – The <cite>BundledProgram</cite> variable to be serialized.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p class="sd-card-text">The serialized FlatBuffer binary data in bytes.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">bundled_program.serialize.</span></span><span class="sig-name descname"><span class="pre">deserialize_from_flatbuffer_to_bundled_program</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">flatbuffer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bundled_program/serialize.html#deserialize_from_flatbuffer_to_bundled_program"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p class="sd-card-text">Deserialize a FlatBuffer binary format into a BundledProgram.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p class="sd-card-text"><strong>flatbuffer</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.12)"><em>bytes</em></a>) – The FlatBuffer binary data in bytes.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p class="sd-card-text">A <cite>BundledProgram</cite> instance.</p>
</dd>
</dl>
</dd></dl>

</div>
</details></div>
<div class="section" id="emit-example">
<h3>Emit Example<a class="headerlink" href="#emit-example" title="Permalink to this headline">¶</a></h3>
<p>Here is a flow highlighting how to generate a <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> given a PyTorch model and the representative inputs we want to test it along with.</p>
<div class="highlight-none notranslate highlight-python"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.export</span> <span class="kn">import</span> <span class="n">export</span>

<span class="kn">from</span> <span class="nn">executorch.bundled_program.config</span> <span class="kn">import</span> <span class="n">BundledConfig</span>
<span class="kn">from</span> <span class="nn">executorch.bundled_program.core</span> <span class="kn">import</span> <span class="n">create_bundled_program</span>
<span class="kn">from</span> <span class="nn">executorch.bundled_program.serialize</span> <span class="kn">import</span> <span class="n">serialize_from_bundled_program_to_flatbuffer</span>

<span class="kn">from</span> <span class="nn">executorch.exir</span> <span class="kn">import</span> <span class="n">to_edge</span>


<span class="c1"># Step 1: ExecuTorch Program Export</span>

<span class="k">class</span> <span class="nc">SampleModel</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An example model with multi-methods. Each method has multiple input and single output&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">q</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>

<span class="c1"># Inference method names of SampleModel we want to bundle testcases to.</span>
<span class="c1"># Notices that we do not need to bundle testcases for every inference methods.</span>
<span class="n">method_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;encode&quot;</span><span class="p">,</span> <span class="s2">&quot;decode&quot;</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SampleModel</span><span class="p">()</span>

<span class="n">capture_inputs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">m_name</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
        <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="n">method_names</span>
<span class="p">}</span>

<span class="c1"># Find each method of model needs to be traced my its name, export its FX Graph.</span>
<span class="n">method_graphs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">m_name</span><span class="p">:</span> <span class="n">export</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">m_name</span><span class="p">),</span> <span class="n">capture_inputs</span><span class="p">[</span><span class="n">m_name</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="n">method_names</span>
<span class="p">}</span>

<span class="c1"># Emit the traced methods into ET Program.</span>
<span class="n">program</span> <span class="o">=</span> <span class="n">to_edge</span><span class="p">(</span><span class="n">method_graphs</span><span class="p">)</span><span class="o">.</span><span class="n">to_executorch</span><span class="p">()</span><span class="o">.</span><span class="n">executorch_program</span>

<span class="c1"># Step 2: Construct BundledConfig</span>

<span class="c1"># number of input sets to be verified</span>
<span class="n">n_input</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Input sets to be verified for each inference methods.</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># The below list is all inputs for a single inference method.</span>
    <span class="p">[</span>
        <span class="c1"># Each list below is a individual input set.</span>
        <span class="c1"># The number of inputs, dtype and size of each input follow Program&#39;s spec.</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_input</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">method_names</span>
<span class="p">]</span>

<span class="c1"># Expected outputs align with inputs.</span>
<span class="n">expected_outputs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">m_name</span><span class="p">)(</span><span class="o">*</span><span class="n">x</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">method_names</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Create BundledConfig</span>
<span class="n">bundled_config</span> <span class="o">=</span> <span class="n">BundledConfig</span><span class="p">(</span>
    <span class="n">method_names</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">expected_outputs</span>
<span class="p">)</span>


<span class="c1"># Step 3: Generate BundledProgram</span>

<span class="n">bundled_program</span> <span class="o">=</span> <span class="n">create_bundled_program</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">bundled_config</span><span class="p">)</span>

<span class="c1"># Step 4: Serialize BundledProgram to flatbuffer.</span>
<span class="n">serialized_bundled_program</span> <span class="o">=</span> <span class="n">serialize_from_bundled_program_to_flatbuffer</span><span class="p">(</span><span class="n">bundled_program</span><span class="p">)</span>
<span class="n">save_path</span> <span class="o">=</span> <span class="s2">&quot;bundled_program.bp&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">serialized_bundled_program</span><span class="p">)</span>

</pre></div>
</div>
<p>We can also regenerate <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> from flatbuffer file if needed:</p>
<div class="highlight-none notranslate highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">executorch.bundled_program.serialize</span> <span class="kn">import</span> <span class="n">deserialize_from_flatbuffer_to_bundled_program</span>
<span class="n">save_path</span> <span class="o">=</span> <span class="s2">&quot;bundled_program.bp&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">serialized_bundled_program</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">regenerate_bundled_program</span> <span class="o">=</span> <span class="n">deserialize_from_flatbuffer_to_bundled_program</span><span class="p">(</span><span class="n">serialized_bundled_program</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="runtime-stage">
<h2>Runtime Stage<a class="headerlink" href="#runtime-stage" title="Permalink to this headline">¶</a></h2>
<p>This stage mainly focuses on executing the model with the bundled inputs and and comparing the model’s output with the bundled expected output. We provide multiple APIs to handle the key parts of it.</p>
<div class="section" id="get-executorch-program-pointer-from-bundledprogram-buffer">
<h3>Get ExecuTorch Program Pointer from <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> Buffer<a class="headerlink" href="#get-executorch-program-pointer-from-bundledprogram-buffer" title="Permalink to this headline">¶</a></h3>
<p>We need the pointer to ExecuTorch program to do the execution. To unify the process of loading and executing <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> and Program flatbuffer, we create an API:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<code class="docutils literal notranslate"><span class="pre">GetProgramData</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p class="sd-card-text">doxygenfunction: Unable to resolve function “torch::executor::util::GetProgramData” with arguments “None”.
Candidate function could not be parsed. Parsing error is
Error when parsing function declaration.
If the function has no return type:
  Error in declarator or parameters-and-qualifiers
  Invalid C++ declaration: Expecting “(” in parameters-and-qualifiers. [error at 15]
    __ET_NODISCARD Error GetProgramData (void *file_data, size_t file_data_len, const void **out_program_data, size_t *out_program_data_len)
    —————^
If the function has a return type:
  Error in declarator or parameters-and-qualifiers
  If pointer to member declarator:
    Invalid C++ declaration: Expected ‘::’ in pointer to member (function). [error at 21]
      __ET_NODISCARD Error GetProgramData (void *file_data, size_t file_data_len, const void **out_program_data, size_t *out_program_data_len)
      ———————^
  If declarator-id:
    Invalid C++ declaration: Expecting “(” in parameters-and-qualifiers. [error at 21]
      __ET_NODISCARD Error GetProgramData (void *file_data, size_t file_data_len, const void **out_program_data, size_t *out_program_data_len)
      ———————^
</p>
</div>
</div>
</details><p>Here’s an example of how to use the <code class="docutils literal notranslate"><span class="pre">GetProgramData</span></code> API:</p>
<div class="highlight-none notranslate highlight-c++"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buff_ptr</span><span class="p">;</span>
<span class="kt">size_t</span><span class="w"> </span><span class="n">buff_len</span><span class="p">;</span>

<span class="c1">// FILE_PATH here can be either BundledProgram or Program flatbuffer file.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">torch</span><span class="o">::</span><span class="n">executor</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">read_file_content</span><span class="p">(</span>
<span class="w">    </span><span class="n">FILE_PATH</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">buff_ptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">buff_len</span><span class="p">);</span>
<span class="n">ET_CHECK_MSG</span><span class="p">(</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Ok</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;read_file_content() failed with status 0x%&quot;</span><span class="w"> </span><span class="n">PRIx32</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="p">);</span>

<span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">program_ptr</span><span class="p">;</span>
<span class="kt">size_t</span><span class="w"> </span><span class="n">program_len</span><span class="p">;</span>
<span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">torch</span><span class="o">::</span><span class="n">executor</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">GetProgramData</span><span class="p">(</span>
<span class="w">    </span><span class="n">buff_ptr</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">buff_len</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">program_ptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">program_len</span><span class="p">);</span>
<span class="n">ET_CHECK_MSG</span><span class="p">(</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Ok</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;GetProgramData() failed with status 0x%&quot;</span><span class="w"> </span><span class="n">PRIx32</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="load-bundled-input-to-method">
<h3>Load Bundled Input to Method<a class="headerlink" href="#load-bundled-input-to-method" title="Permalink to this headline">¶</a></h3>
<p>To execute the program on the bundled input, we need to load the bundled input into the method. Here we provided an API called <code class="docutils literal notranslate"><span class="pre">torch::executor::util::LoadBundledInput</span></code>:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<code class="docutils literal notranslate"><span class="pre">LoadBundledInput</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p class="sd-card-text">doxygenfunction: Unable to resolve function “torch::executor::util::LoadBundledInput” with arguments “None”.
Candidate function could not be parsed. Parsing error is
Error when parsing function declaration.
If the function has no return type:
  Error in declarator or parameters-and-qualifiers
  Invalid C++ declaration: Expecting “(” in parameters-and-qualifiers. [error at 15]
    __ET_NODISCARD Error LoadBundledInput (Method &amp;method, serialized_bundled_program *bundled_program_ptr, MemoryAllocator *memory_allocator, const char *method_name, size_t testset_idx)
    —————^
If the function has a return type:
  Error in declarator or parameters-and-qualifiers
  If pointer to member declarator:
    Invalid C++ declaration: Expected ‘::’ in pointer to member (function). [error at 21]
      __ET_NODISCARD Error LoadBundledInput (Method &amp;method, serialized_bundled_program *bundled_program_ptr, MemoryAllocator *memory_allocator, const char *method_name, size_t testset_idx)
      ———————^
  If declarator-id:
    Invalid C++ declaration: Expecting “(” in parameters-and-qualifiers. [error at 21]
      __ET_NODISCARD Error LoadBundledInput (Method &amp;method, serialized_bundled_program *bundled_program_ptr, MemoryAllocator *memory_allocator, const char *method_name, size_t testset_idx)
      ———————^
</p>
</div>
</div>
</details></div>
<div class="section" id="verify-the-method-s-output">
<h3>Verify the Method’s Output.<a class="headerlink" href="#verify-the-method-s-output" title="Permalink to this headline">¶</a></h3>
<p>We call <code class="docutils literal notranslate"><span class="pre">torch::executor::util::VerifyResultWithBundledExpectedOutput</span></code> to verify the method’s output with bundled expected outputs. Here’s the details of this API:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<code class="docutils literal notranslate"><span class="pre">VerifyResultWithBundledExpectedOutput</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p class="sd-card-text">doxygenfunction: Unable to resolve function “torch::executor::util::VerifyResultWithBundledExpectedOutput” with arguments “None”.
Candidate function could not be parsed. Parsing error is
Error when parsing function declaration.
If the function has no return type:
  Error in declarator or parameters-and-qualifiers
  Invalid C++ declaration: Expecting “(” in parameters-and-qualifiers. [error at 15]
    __ET_NODISCARD Error VerifyResultWithBundledExpectedOutput (Method &amp;method, serialized_bundled_program *bundled_program_ptr, MemoryAllocator *memory_allocator, const char *method_name, size_t testset_idx, double rtol, double atol)
    —————^
If the function has a return type:
  Error in declarator or parameters-and-qualifiers
  If pointer to member declarator:
    Invalid C++ declaration: Expected ‘::’ in pointer to member (function). [error at 21]
      __ET_NODISCARD Error VerifyResultWithBundledExpectedOutput (Method &amp;method, serialized_bundled_program *bundled_program_ptr, MemoryAllocator *memory_allocator, const char *method_name, size_t testset_idx, double rtol, double atol)
      ———————^
  If declarator-id:
    Invalid C++ declaration: Expecting “(” in parameters-and-qualifiers. [error at 21]
      __ET_NODISCARD Error VerifyResultWithBundledExpectedOutput (Method &amp;method, serialized_bundled_program *bundled_program_ptr, MemoryAllocator *memory_allocator, const char *method_name, size_t testset_idx, double rtol, double atol)
      ———————^
</p>
</div>
</div>
</details></div>
<div class="section" id="runtime-example">
<h3>Runtime Example<a class="headerlink" href="#runtime-example" title="Permalink to this headline">¶</a></h3>
<p>Here we provide an example about how to run the bundled program step by step. Most of the code is borrowed from <a class="reference external" href="https://github.com/pytorch/executorch/blob/main/examples/sdk/sdk_example_runner/sdk_example_runner.cpp">executor_runner</a>, and please review that file if you need more info and context:</p>
<div class="highlight-none notranslate highlight-c++"><div class="highlight"><pre><span></span><span class="c1">// method_name is the name for the method we want to test</span>
<span class="c1">// memory_manager is the executor::MemoryManager variable for executor memory allocation.</span>
<span class="c1">// program is the ExecuTorch program.</span>
<span class="n">Result</span><span class="o">&lt;</span><span class="n">Method</span><span class="o">&gt;</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">program</span><span class="o">-&gt;</span><span class="n">load_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">memory_manager</span><span class="p">);</span>

<span class="n">ET_CHECK_MSG</span><span class="p">(</span>
<span class="w">    </span><span class="n">method</span><span class="p">.</span><span class="n">ok</span><span class="p">(),</span>
<span class="w">    </span><span class="s">&quot;load_method() failed with status 0x%&quot;</span><span class="w"> </span><span class="n">PRIx32</span><span class="p">,</span>
<span class="w">    </span><span class="n">method</span><span class="p">.</span><span class="n">error</span><span class="p">());</span>

<span class="c1">// Load testset_idx-th input in the buffer to plan</span>
<span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">torch</span><span class="o">::</span><span class="n">executor</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">LoadBundledInput</span><span class="p">(</span>
<span class="w">        </span><span class="o">*</span><span class="n">method</span><span class="p">,</span>
<span class="w">        </span><span class="n">program_data</span><span class="p">.</span><span class="n">bundled_program_data</span><span class="p">(),</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">bundled_input_allocator</span><span class="p">,</span>
<span class="w">        </span><span class="n">method_name</span><span class="p">,</span>
<span class="w">        </span><span class="n">FLAGS_testset_idx</span><span class="p">);</span>
<span class="n">ET_CHECK_MSG</span><span class="p">(</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Ok</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;LoadBundledInput failed with status 0x%&quot;</span><span class="w"> </span><span class="n">PRIx32</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="p">);</span>

<span class="c1">// Execute the plan</span>
<span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="o">-&gt;</span><span class="n">execute</span><span class="p">();</span>
<span class="n">ET_CHECK_MSG</span><span class="p">(</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Ok</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;method-&gt;execute() failed with status 0x%&quot;</span><span class="w"> </span><span class="n">PRIx32</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="p">);</span>

<span class="c1">// Verify the result.</span>
<span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">torch</span><span class="o">::</span><span class="n">executor</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">VerifyResultWithBundledExpectedOutput</span><span class="p">(</span>
<span class="w">        </span><span class="o">*</span><span class="n">method</span><span class="p">,</span>
<span class="w">        </span><span class="n">program_data</span><span class="p">.</span><span class="n">bundled_program_data</span><span class="p">(),</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">bundled_input_allocator</span><span class="p">,</span>
<span class="w">        </span><span class="n">method_name</span><span class="p">,</span>
<span class="w">        </span><span class="n">FLAGS_testset_idx</span><span class="p">,</span>
<span class="w">        </span><span class="n">FLAGS_rtol</span><span class="p">,</span>
<span class="w">        </span><span class="n">FLAGS_atol</span><span class="p">);</span>
<span class="n">ET_CHECK_MSG</span><span class="p">(</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Error</span><span class="o">::</span><span class="n">Ok</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;Bundle verification failed with status 0x%&quot;</span><span class="w"> </span><span class="n">PRIx32</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="common-errors">
<h2>Common Errors<a class="headerlink" href="#common-errors" title="Permalink to this headline">¶</a></h2>
<p>Errors will be raised if <code class="docutils literal notranslate"><span class="pre">BundledConfig</span></code> doesn’t match the <code class="docutils literal notranslate"><span class="pre">Program</span></code>. Here’re two common situations:</p>
<div class="section" id="test-input-doesn-t-match-model-s-requirement">
<h3>Test input doesn’t match model’s requirement.<a class="headerlink" href="#test-input-doesn-t-match-model-s-requirement" title="Permalink to this headline">¶</a></h3>
<p>Each inference method of PyTorch model has its own requirement for the inputs, like number of input, the dtype of each input, etc. <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> will raise error if test input not meet the requirement.</p>
<p>Here’s the example of the dtype of test input not meet model’s requirement:</p>
<div class="highlight-none notranslate highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.export</span> <span class="kn">import</span> <span class="n">export</span>

<span class="kn">from</span> <span class="nn">executorch.bundled_program.config</span> <span class="kn">import</span> <span class="n">BundledConfig</span>
<span class="kn">from</span> <span class="nn">executorch.bundled_program.core</span> <span class="kn">import</span> <span class="n">create_bundled_program</span>

<span class="kn">from</span> <span class="nn">executorch.exir</span> <span class="kn">import</span> <span class="n">to_edge</span>


<span class="k">class</span> <span class="nc">Module</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">out_1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">out_2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out_1</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">out_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out_2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out_2</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>
<span class="n">method_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;forward&#39;</span><span class="p">]</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>

<span class="c1"># Find each method of model needs to be traced my its name, export its FX Graph.</span>
<span class="n">method_graphs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">m_name</span><span class="p">:</span> <span class="n">export</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">m_name</span><span class="p">),</span> <span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="p">))</span>
    <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="n">method_names</span>
<span class="p">}</span>

<span class="c1"># Emit the traced methods into ET Program.</span>
<span class="n">program</span> <span class="o">=</span> <span class="n">to_edge</span><span class="p">(</span><span class="n">method_graphs</span><span class="p">)</span><span class="o">.</span><span class="n">to_executorch</span><span class="p">()</span><span class="o">.</span><span class="n">executorch_program</span>


<span class="c1"># number of input sets to be verified</span>
<span class="n">n_input</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># All Input sets to be verified.</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="c1"># NOTE: executorch program needs torch.float, but here is torch.int</span>
        <span class="p">[</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_input</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">]</span>

<span class="c1"># Expected outputs align with inputs.</span>
<span class="n">expected_outpus</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[[</span><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="p">]</span>

<span class="n">bundled_config</span> <span class="o">=</span> <span class="n">BundledConfig</span><span class="p">(</span><span class="n">method_names</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">expected_outpus</span><span class="p">)</span>

<span class="n">bundled_program</span> <span class="o">=</span> <span class="n">create_bundled_program</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">bundled_config</span><span class="p">)</span>
</pre></div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Raised Error<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-none notranslate highlight-default"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="nb">input</span> <span class="n">tensor</span> <span class="n">tensor</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="n">dtype</span> <span class="n">shall</span> <span class="n">be</span> <span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">but</span> <span class="n">now</span> <span class="ow">is</span> <span class="n">torch</span><span class="o">.</span><span class="n">int32</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
     <span class="mi">57</span> <span class="n">expected_outpus</span> <span class="o">=</span> <span class="p">[</span>
     <span class="mi">58</span>     <span class="p">[[</span><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
     <span class="mi">59</span> <span class="p">]</span>
     <span class="mi">61</span> <span class="n">bundled_config</span> <span class="o">=</span> <span class="n">BundledConfig</span><span class="p">(</span><span class="n">method_names</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">expected_outpus</span><span class="p">)</span>
<span class="o">---&gt;</span> <span class="mi">63</span> <span class="n">bundled_program</span> <span class="o">=</span> <span class="n">create_bundled_program</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">bundled_config</span><span class="p">)</span>
<span class="n">File</span> <span class="o">/</span><span class="n">executorch</span><span class="o">/</span><span class="n">bundled_program</span><span class="o">/</span><span class="n">core</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">270</span><span class="p">,</span> <span class="ow">in</span> <span class="n">create_bundled_program</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">bundled_config</span><span class="p">)</span>
    <span class="mi">259</span> <span class="k">def</span> <span class="nf">create_bundled_program</span><span class="p">(</span>
    <span class="mi">260</span>     <span class="n">program</span><span class="p">:</span> <span class="n">Program</span><span class="p">,</span>
    <span class="mi">261</span>     <span class="n">bundled_config</span><span class="p">:</span> <span class="n">BundledConfig</span><span class="p">,</span>
    <span class="mi">262</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BundledProgram</span><span class="p">:</span>
    <span class="mi">263</span>     <span class="s2">&quot;&quot;&quot;Create BundledProgram by bundling the given program and bundled_config together.</span>
<span class="s2">    264</span>
<span class="s2">    265     Args:</span>
<span class="s2">    266         program: The program to be bundled.</span>
<span class="s2">    267         bundled_config: The config to be bundled.</span>
<span class="s2">    268     &quot;&quot;&quot;</span>
<span class="o">--&gt;</span> <span class="mi">270</span>     <span class="n">assert_valid_bundle</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">bundled_config</span><span class="p">)</span>
    <span class="mi">272</span>     <span class="n">execution_plan_tests</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BundledExecutionPlanTest</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="mi">274</span>     <span class="c1"># Emit data and metadata of bundled tensor</span>
<span class="n">File</span> <span class="o">/</span><span class="n">executorch</span><span class="o">/</span><span class="n">bundled_program</span><span class="o">/</span><span class="n">core</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">224</span><span class="p">,</span> <span class="ow">in</span> <span class="n">assert_valid_bundle</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">bundled_config</span><span class="p">)</span>
    <span class="mi">220</span> <span class="c1"># type of tensor input should match execution plan</span>
    <span class="mi">221</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cur_plan_test_inputs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
    <span class="mi">222</span>     <span class="c1"># pyre-fixme[16]: Undefined attribute [16]: Item `bool` of `typing.Union[bool, float, int, torch._tensor.Tensor]`</span>
    <span class="mi">223</span>     <span class="c1"># has no attribute `dtype`.</span>
<span class="o">--&gt;</span> <span class="mi">224</span>     <span class="k">assert</span> <span class="n">cur_plan_test_inputs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">get_input_dtype</span><span class="p">(</span>
    <span class="mi">225</span>         <span class="n">program</span><span class="p">,</span> <span class="n">program_plan_id</span><span class="p">,</span> <span class="n">j</span>
    <span class="mi">226</span>     <span class="p">),</span> <span class="s2">&quot;The input tensor </span><span class="si">{}</span><span class="s2"> dtype shall be </span><span class="si">{}</span><span class="s2">, but now is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="mi">227</span>         <span class="n">cur_plan_test_inputs</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
    <span class="mi">228</span>         <span class="n">get_input_dtype</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">program_plan_id</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span>
    <span class="mi">229</span>         <span class="n">cur_plan_test_inputs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
    <span class="mi">230</span>     <span class="p">)</span>
    <span class="mi">231</span> <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">cur_plan_test_inputs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span>
    <span class="mi">232</span>     <span class="nb">int</span><span class="p">,</span>
    <span class="mi">233</span>     <span class="nb">bool</span><span class="p">,</span>
    <span class="mi">234</span>     <span class="nb">float</span><span class="p">,</span>
    <span class="mi">235</span> <span class="p">):</span>
    <span class="mi">236</span>     <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">cur_plan_test_inputs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="n">get_input_type</span><span class="p">(</span>
    <span class="mi">237</span>         <span class="n">program</span><span class="p">,</span> <span class="n">program_plan_id</span><span class="p">,</span> <span class="n">j</span>
    <span class="mi">238</span>     <span class="p">),</span> <span class="s2">&quot;The input primitive dtype shall be </span><span class="si">{}</span><span class="s2">, but now is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="mi">239</span>         <span class="n">get_input_type</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">program_plan_id</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span>
    <span class="mi">240</span>         <span class="nb">type</span><span class="p">(</span><span class="n">cur_plan_test_inputs</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
    <span class="mi">241</span>     <span class="p">)</span>
<span class="ne">AssertionError</span><span class="p">:</span> <span class="n">The</span> <span class="nb">input</span> <span class="n">tensor</span> <span class="n">tensor</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="n">dtype</span> <span class="n">shall</span> <span class="n">be</span> <span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">but</span> <span class="n">now</span> <span class="ow">is</span> <span class="n">torch</span><span class="o">.</span><span class="n">int32</span>

</pre></div>
</div>
</div>
</details></div>
<div class="section" id="method-name-in-bundleconfig-does-not-exist">
<h3>Method name in <code class="docutils literal notranslate"><span class="pre">BundleConfig</span></code> does not exist.<a class="headerlink" href="#method-name-in-bundleconfig-does-not-exist" title="Permalink to this headline">¶</a></h3>
<p>Another common error would be the method name in <code class="docutils literal notranslate"><span class="pre">BundledConfig</span></code> does not exist in Model. <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> will raise error and show the non-exist method name:</p>
<div class="highlight-none notranslate highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.export</span> <span class="kn">import</span> <span class="n">export</span>

<span class="kn">from</span> <span class="nn">executorch.bundled_program.config</span> <span class="kn">import</span> <span class="n">BundledConfig</span>
<span class="kn">from</span> <span class="nn">executorch.bundled_program.core</span> <span class="kn">import</span> <span class="n">create_bundled_program</span>

<span class="kn">from</span> <span class="nn">executorch.exir</span> <span class="kn">import</span> <span class="n">to_edge</span>



<span class="k">class</span> <span class="nc">Module</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">out_1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">out_2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out_1</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">out_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out_2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out_2</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>

<span class="n">method_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;forward&#39;</span><span class="p">]</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

<span class="c1"># Find each method of model needs to be traced my its name, export its FX Graph.</span>
<span class="n">method_graphs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">m_name</span><span class="p">:</span> <span class="n">export</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">m_name</span><span class="p">),</span> <span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="p">))</span>
    <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="n">method_names</span>
<span class="p">}</span>

<span class="c1"># Emit the traced methods into ET Program.</span>
<span class="n">program</span> <span class="o">=</span> <span class="n">to_edge</span><span class="p">(</span><span class="n">method_graphs</span><span class="p">)</span><span class="o">.</span><span class="n">to_executorch</span><span class="p">()</span><span class="o">.</span><span class="n">executorch_program</span>

<span class="c1"># Number of input sets to be verified</span>
<span class="n">n_input</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># All Input sets to be verified.</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="p">[</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_input</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">]</span>

<span class="c1"># Expected outputs align with inputs.</span>
<span class="n">expected_outpus</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[[</span><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="p">]</span>


<span class="c1"># NOTE: MISSING_METHOD_NAME is not an inference method in the above model.</span>
<span class="n">wrong_method_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MISSING_METHOD_NAME&#39;</span><span class="p">]</span>

<span class="n">bundled_config</span> <span class="o">=</span> <span class="n">BundledConfig</span><span class="p">(</span><span class="n">wrong_method_names</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">expected_outpus</span><span class="p">)</span>

<span class="n">bundled_program</span> <span class="o">=</span> <span class="n">create_bundled_program</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">bundled_config</span><span class="p">)</span>

</pre></div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Raised Error<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-none notranslate highlight-default"><div class="highlight"><pre><span></span><span class="n">All</span> <span class="n">method</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">bundled</span> <span class="n">config</span> <span class="n">should</span> <span class="n">be</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">program</span><span class="o">.</span><span class="n">execution_plan</span><span class="p">,</span>          <span class="n">but</span> <span class="p">{</span><span class="s1">&#39;wrong_forward&#39;</span><span class="p">}</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">include</span><span class="o">.</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
     <span class="mi">58</span> <span class="n">expected_outpus</span> <span class="o">=</span> <span class="p">[</span>
     <span class="mi">59</span>     <span class="p">[[</span><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
     <span class="mi">60</span> <span class="p">]</span>
     <span class="mi">62</span> <span class="n">bundled_config</span> <span class="o">=</span> <span class="n">BundledConfig</span><span class="p">(</span><span class="n">method_names</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">expected_outpus</span><span class="p">)</span>
<span class="o">---&gt;</span> <span class="mi">64</span> <span class="n">bundled_program</span> <span class="o">=</span> <span class="n">create_bundled_program</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">bundled_config</span><span class="p">)</span>
<span class="n">File</span> <span class="o">/</span><span class="n">executorch</span><span class="o">/</span><span class="n">bundled_program</span><span class="o">/</span><span class="n">core</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">270</span><span class="p">,</span> <span class="ow">in</span> <span class="n">create_bundled_program</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">bundled_config</span><span class="p">)</span>
    <span class="mi">259</span> <span class="k">def</span> <span class="nf">create_bundled_program</span><span class="p">(</span>
    <span class="mi">260</span>     <span class="n">program</span><span class="p">:</span> <span class="n">Program</span><span class="p">,</span>
    <span class="mi">261</span>     <span class="n">bundled_config</span><span class="p">:</span> <span class="n">BundledConfig</span><span class="p">,</span>
    <span class="mi">262</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BundledProgram</span><span class="p">:</span>
    <span class="mi">263</span>     <span class="s2">&quot;&quot;&quot;Create BundledProgram by bundling the given program and bundled_config together.</span>
<span class="s2">    264</span>
<span class="s2">    265     Args:</span>
<span class="s2">    266         program: The program to be bundled.</span>
<span class="s2">    267         bundled_config: The config to be bundled.</span>
<span class="s2">    268     &quot;&quot;&quot;</span>
<span class="o">--&gt;</span> <span class="mi">270</span>     <span class="n">assert_valid_bundle</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">bundled_config</span><span class="p">)</span>
    <span class="mi">272</span>     <span class="n">execution_plan_tests</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BundledExecutionPlanTest</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="mi">274</span>     <span class="c1"># Emit data and metadata of bundled tensor</span>
<span class="n">File</span> <span class="o">/</span><span class="n">executorch</span><span class="o">/</span><span class="n">bundled_program</span><span class="o">/</span><span class="n">core</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">147</span><span class="p">,</span> <span class="ow">in</span> <span class="n">assert_valid_bundle</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">bundled_config</span><span class="p">)</span>
    <span class="mi">142</span> <span class="n">method_name_of_program</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">program</span><span class="o">.</span><span class="n">execution_plan</span><span class="p">}</span>
    <span class="mi">143</span> <span class="n">method_name_of_bundled_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">144</span>     <span class="n">t</span><span class="o">.</span><span class="n">method_name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">bundled_config</span><span class="o">.</span><span class="n">execution_plan_tests</span>
    <span class="mi">145</span> <span class="p">}</span>
<span class="o">--&gt;</span> <span class="mi">147</span> <span class="k">assert</span> <span class="n">method_name_of_bundled_config</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span>
    <span class="mi">148</span>     <span class="n">method_name_of_program</span>
    <span class="mi">149</span> <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;All method names in bundled config should be found in program.execution_plan, </span><span class="se">\</span>
<span class="s2">    150      but </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">method_name_of_bundled_config</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">method_name_of_program</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not include.&quot;</span>
    <span class="mi">152</span> <span class="c1"># check if  has been sorted in ascending alphabetical order of method name.</span>
    <span class="mi">153</span> <span class="k">for</span> <span class="n">bp_plan_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bundled_config</span><span class="o">.</span><span class="n">execution_plan_tests</span><span class="p">)):</span>
<span class="ne">AssertionError</span><span class="p">:</span> <span class="n">All</span> <span class="n">method</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">bundled</span> <span class="n">config</span> <span class="n">should</span> <span class="n">be</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">program</span><span class="o">.</span><span class="n">execution_plan</span><span class="p">,</span>          <span class="n">but</span> <span class="p">{</span><span class="s1">&#39;MISSING_METHOD_NAME&#39;</span><span class="p">}</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">include</span><span class="o">.</span>
</pre></div>
</div>
</div>
</details></div>
</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sdk-etrecord.html" class="btn btn-neutral float-right" title="Prerequisite | ETRecord - ExecuTorch Record" accesskey="n" rel="next">Next <img src="_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="sdk-overview.html" class="btn btn-neutral" title="Introduction to the ExecuTorch SDK" accesskey="p" rel="prev"><img src="_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, ExecuTorch.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>


        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">Bundled Program – a Tool for ExecuTorch Model Validation</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#emit-stage">Emit stage</a><ul>
<li><a class="reference internal" href="#step-1-create-a-model-and-emit-its-executorch-program">Step 1: Create a Model and Emit its ExecuTorch Program.</a></li>
<li><a class="reference internal" href="#step-2-construct-bundledconfig">Step 2: Construct <code class="docutils literal notranslate"><span class="pre">BundledConfig</span></code></a></li>
<li><a class="reference internal" href="#step-3-generate-bundledprogram">Step 3: Generate <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code></a></li>
<li><a class="reference internal" href="#step-4-serialize-bundledprogram-to-flatbuffer">Step 4: Serialize <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> to Flatbuffer.</a></li>
<li><a class="reference internal" href="#emit-example">Emit Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#runtime-stage">Runtime Stage</a><ul>
<li><a class="reference internal" href="#get-executorch-program-pointer-from-bundledprogram-buffer">Get ExecuTorch Program Pointer from <code class="docutils literal notranslate"><span class="pre">BundledProgram</span></code> Buffer</a></li>
<li><a class="reference internal" href="#load-bundled-input-to-method">Load Bundled Input to Method</a></li>
<li><a class="reference internal" href="#verify-the-method-s-output">Verify the Method’s Output.</a></li>
<li><a class="reference internal" href="#runtime-example">Runtime Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-errors">Common Errors</a><ul>
<li><a class="reference internal" href="#test-input-doesn-t-match-model-s-requirement">Test input doesn’t match model’s requirement.</a></li>
<li><a class="reference internal" href="#method-name-in-bundleconfig-does-not-exist">Method name in <code class="docutils literal notranslate"><span class="pre">BundleConfig</span></code> does not exist.</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
         <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
         <script src="_static/jquery.js"></script>
         <script src="_static/underscore.js"></script>
         <script src="_static/doctools.js"></script>
         <script src="_static/clipboard.min.js"></script>
         <script src="_static/copybutton.js"></script>
         <script src="_static/design-tabs.js"></script>
         <script src="_static/js/progress-bar.js"></script>
     

  

  <script type="text/javascript" src="_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
 
<script script type="text/javascript">
  var collapsedSections = ['Introduction', 'Getting Started', 'Exporting to ExecuTorch', 'API Reference', 'IR Specification', 'Compiler Entry Points', 'Runtime', 'Quantization', 'Kernel Library', 'Native Delegates', 'SDK', 'Tutorials']
</script>

 
<script type="text/javascript">
  $(document).ready(function () {
    // Patch links on interactive tutorial pages to point
    // to the correct ExecuTorch URLs.
    var downloadNote = $(".sphx-glr-download-link-note.admonition.note");
    if (downloadNote.length >= 1) {
      var tutorialUrl = $("#tutorial-type").text().substring($("#tutorial-type").text().indexOf("tutorials/") + 9); // 9 is the length of "tutorials/"
      var githubLink = "https://github.com/pytorch/executorch/blob/main/docs/source/tutorials_source" + tutorialUrl + ".py",
        notebookLink = $(".reference.download")[1].href,
        notebookDownloadPath = notebookLink.split('_downloads')[1],
        colabLink = "https://colab.research.google.com/github/pytorch/executorch/blob/gh-pages/main/_downloads" + notebookDownloadPath;

      $(".pytorch-call-to-action-links a[data-response='Run in Google Colab']").attr("href", colabLink);
      $(".pytorch-call-to-action-links a[data-response='View on Github']").attr("href", githubLink);
    }

    // Patch the "GitHub" link at the top of the page
    // to point to the ExecuTorch repo.
    var overwrite = function (_) {
      if ($(this).length > 0) {
        $(this)[0].href = "https://github.com/pytorch/executorch"
      }
    }
    // PC
    $(".main-menu a:contains('GitHub')").each(overwrite);
    // Overwrite link to Tutorials and Get Started top navigation. If these sections are moved
    // this overrides need to be updated.
    $(".main-menu a:contains('Tutorials')").attr("href", "https://pytorch.org/executorch/stable/index.html#tutorials-and-examples");
    $(".main-menu a:contains('Get Started')").attr("href", "https://pytorch.org/executorch/stable/getting-started-setup.html");
    // Mobile
    $(".mobile-menu a:contains('Github')").each(overwrite);
    // Overwrite link to Tutorials and Get Started top navigation. If these sections are moved
    // this overrides need to be updated.
    $(".mobile-menu a:contains('Tutorials')").attr("href", "https://pytorch.org/executorch/stable/index.html#tutorials-and-examples");
    $(".mobile-menu a:contains('Get Started')").attr("href", "https://pytorch.org/executorch/stable/getting-started-setup.html");

  });
</script>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">Stay up to date</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">Twitter</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">LinkedIn</a></li>
          </ul>  
          </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch Podcasts</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">Apple</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">Google</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">Amazon</a></li>
          </ul>
         </div>
        </div>
        
        <div class="privacy-policy">
          <ul>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">Terms</a></li>
            <li class="privacy-policy-links">|</li>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">Privacy</a></li>
          </ul>
        </div>
        <div class="copyright">
        <p>© Copyright The Linux Foundation. The PyTorch Foundation is a project of The Linux Foundation.
          For web site terms of use, trademark policy and other policies applicable to The PyTorch Foundation please see
          <a href="www.linuxfoundation.org/policies/">www.linuxfoundation.org/policies/</a>. The PyTorch Foundation supports the PyTorch open source
          project, which has been established as PyTorch Project a Series of LF Projects, LLC. For policies applicable to the PyTorch Project a Series of LF Projects, LLC,
          please see <a href="www.lfprojects.org/policies/">www.lfprojects.org/policies/</a>.</p>
      </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>
            
          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/torcharrow">torcharrow</a>
            </li>

            <li>
              <a href="https://pytorch.org/data">TorchData</a>
            </li>

            <li>
              <a href="https://pytorch.org/torchrec">TorchRec</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/torchx/">TorchX</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>
            
           <ul class="resources-mobile-menu-items">

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/foundation">PyTorch Foundation</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://pytorch.org/community-stories">Community Stories</a>
            </li>

            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/events">Events</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>